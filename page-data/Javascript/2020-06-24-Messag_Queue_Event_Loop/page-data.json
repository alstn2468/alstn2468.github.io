{"componentChunkName":"component---src-templates-blog-post-js","path":"/Javascript/2020-06-24-Messag_Queue_Event_Loop","result":{"data":{"site":{"siteMetadata":{"title":"Minsu's Dev Log","author":"Minsu Kim","siteUrl":"https://alstn2468.github.io","comment":{"disqusShortName":"","utterances":"alstn2468/alstn2468.github.io"},"sponsor":{"buyMeACoffeeId":"eMLdEwU"}}},"markdownRemark":{"id":"26398a73-e787-5af1-8554-837c6767cb0a","excerpt":"33-js-concepts를 스터디하며 정리한 포스트 입니다. 자바스크립트의 특징 자바스크립트는 싱글 스레드 기반의 언어이며 1개의 콜스택을 사용한다.\n1개의 콜스택을 사용하기 때문에 하나의 함수의 작업이 오래걸리게 되면\n그 이후에 실행될 다른 작업들은 실행이 되지 못하는 상황이 발생하게 된다.\n이 문제를 해결하기 위하여 비동기 콜백 방식을 사용하고 있다.\n이와 관련된 내용이 메시지 큐와 이벤트 루프다. 메시지 큐 메시지 큐는 자료구조 큐(Queue…","html":"<p><a href=\"https://github.com/leonardomso/33-js-concepts\">33-js-concepts</a>를 스터디하며 정리한 포스트 입니다.</p>\n<h2 id=\"자바스크립트의-특징\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"자바스크립트의 특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자바스크립트의 특징</h2>\n<p>자바스크립트는 <strong>싱글 스레드</strong> 기반의 언어이며 1개의 <strong>콜스택</strong>을 사용한다.<br/>\n1개의 <strong>콜스택</strong>을 사용하기 때문에 하나의 함수의 작업이 오래걸리게 되면<br/>\n그 이후에 실행될 다른 작업들은 실행이 되지 못하는 상황이 발생하게 된다.<br/>\n이 문제를 해결하기 위하여 <strong>비동기 콜백</strong> 방식을 사용하고 있다.<br/>\n이와 관련된 내용이 <strong>메시지 큐</strong>와 <strong>이벤트 루프</strong>다.</p>\n<h2 id=\"메시지-큐\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%81%90\" aria-label=\"메시지 큐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메시지 큐</h2>\n<p>메시지 큐는 자료구조 큐(<strong>Queue</strong>)를 기반으로 구성되어 있다.<br/>\n큐는 먼저들어온 것이 먼저나가는 <strong>FIFO</strong>(<strong>F</strong>irst <strong>I</strong>n <strong>F</strong>irst <strong>O</strong>ut)의 특징을 갖는다.<br/>\n자바스크립트의 브라우저 엔진의 메시지 큐에는 <strong>비동기</strong>로 처리될 <strong>콜백 함수</strong>가 저장된다.<br/></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 76.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQ4y21Uy2oUQRSdH/JjFNwK2ajgUsGVKxf+gS9wI4gL4wuU4AOTgLhIonkQEqJJRjPOTI+Z7unpVHfX+3jr9kzTM1r0oYqquqfOuXWrW71ogI+fVhgHPw7hHGD0CFbuwNkI1oJgGzAAPH2EMPKO58Kao+BWOs5w/PMX2oRoEMHRPidXcbB+DieH9znIWk2BnhFaelZgLArEowyi1DwXyAJpC43GJ5FCpw/w9cstHB8u87xSkjcznRpjf2MZ6ytvsEY42v4M6IyE+IpwymyMIasG49EYw3jE1oUoSfUApSRCWmfC3cewS1eRv7uO8v0NmKXLwN4TuImgVrARSB1JE0ogyvooCwkpCxhVQhaCyDQdOLG2+QD5s4vIXy9AvFrgsdt+xIfVhJYIvfWIZYpOtg+0N4ncIs4tEgkkQjEpE367C714AeLlJYZePA+/9XCWMCg0NlimK/1+BJMOERPJ6onBh7bGVl+RA81BvrdGFp9C7j2HIoSx729MLNsGobFkU1HiMux3BDaOEqz3DJbbEjvRJIdhb1U0dfNTTG+5ziFBKQVJk6EvSolhVuJ0XCA5K+u6YxJnZ0G1WN+ynwyqIvV8knNVH1qRC0gij+MEnc5vDAZ/6nqc1iaLmidsLvqGmqC2LAXSNEE8PEWSxNBUXlxmhOBs6nJW4RxZFPWxu7tHeT1D3rkGM7wD2b0Cm73gnDlXPTet517K/xTy80pH6HZ70CqH6N5GeXoPonMTMn0LqjB+jkFhUPsPYViY/QHYmpiDKIZhqz6kQSnNaMbyz2E+dzOJnuQn3GKFkBrXfP7/xPwFVeh8VGK5+/kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"1\" title=\"1\" src=\"/static/2e48f9b32e3e2d2fe550c0c756650377/0a47e/1.png\" srcset=\"/static/2e48f9b32e3e2d2fe550c0c756650377/8a4e8/1.png 150w,\n/static/2e48f9b32e3e2d2fe550c0c756650377/5a46d/1.png 300w,\n/static/2e48f9b32e3e2d2fe550c0c756650377/0a47e/1.png 600w,\n/static/2e48f9b32e3e2d2fe550c0c756650377/6af66/1.png 640w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n<p><strong>콜스택</strong>이 비어있게 되면 메시지 큐에 있는 <strong>콜백 함수</strong>를 꺼내와 실행하게 된다.<br/>\n<strong>메시지큐</strong>에서 <strong>콜백 함수</strong>를 꺼내오는 이 과정은 <strong>이벤트 루프</strong>가 담당한다.<br/></p>\n<h2 id=\"이벤트-루프\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84\" aria-label=\"이벤트 루프 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 루프</h2>\n<p>이벤트 루프는 <strong>콜스택이 비어있으면</strong> 메시지 큐에서 <strong>콜백 함수를 꺼내 실행</strong>하는 역할을 한다.<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">.</span><span class=\"token function\">waitForMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  queue<span class=\"token punctuation\">.</span><span class=\"token function\">processNextMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같은 가상의 코드로 이벤트 루프를 설명할 수 있다.<br/>\n<code class=\"language-text\">waitForMessage</code>함수를 이용해 실행 중인 함수가 없을때 까지 대기하게된다.<br/></p>\n<h2 id=\"메시지-큐-와-이벤트-루프-예시\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%81%90-%EC%99%80-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84-%EC%98%88%EC%8B%9C\" aria-label=\"메시지 큐 와 이벤트 루프 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메시지 큐 와 이벤트 루프 예시</h2>\n<p><code class=\"language-text\">setTimeout</code>을 이용해 비동기 적인 흐름을 작성해볼 수 있다.<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>위와 같이 <code class=\"language-text\">setTimeout</code>함수에 <code class=\"language-text\">1000ms</code>를 주어 실행하게되면<br/>\n1초뒤에 <code class=\"language-text\">bar</code>가 출력되는 것을 확인 할 수 있다.<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">foo\n<span class=\"token operator\">...</span> after 1sec <span class=\"token operator\">...</span>\nbar</code></pre></div>\n<p><code class=\"language-text\">setTimeout</code>에 <code class=\"language-text\">0ms</code>를 주어 실행하면 <code class=\"language-text\">bar</code>부터 출력이 될 것 같지만 그렇지 않다.<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">foo</code>가 먼저 출력이 된 후 <code class=\"language-text\">bar</code>가 출력이 되는 것을 확인할 수 있다.<br/>\n<code class=\"language-text\">setTimeout</code>을 사용하게 되면서 <code class=\"language-text\">bar</code>함수는 <strong>메시지 큐</strong>에 들어가게된다.<br/>\n그 후 <code class=\"language-text\">foo</code>함수는 <strong>콜스택</strong>에 들어가게 된다. 그림으로 표현하면 아래와 같다.<br/></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 518px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 94%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByElEQVQ4y7VUSW7CQBDk/zeewAs4cEUciNgEyCAb4bDZZgm7AbOJtTLVwSiJAoYoaamFZzyUq6t6OgQV6/UKTruNQb8Px3EwGo24jfP5rBJPRYh/euv1oGklNOp15PN56LqBzXZ7BX0K0PM8NFstxXKN2Wwmv8PhUJgyTqfTc4Dz+Rzj8fjL5n6/R7fb/R3DxWKBwWDwhc1ms/lbwK3S798AueeDPgIeCOiH/y4I9KaGnU5HntmTx+PxcYY/uXw4HK6AbdXwsVjsug4qX/qwVqthMpkIU4Lbti1ADF3XYZomotHop9tzm2louVwilUphOp1irEC5LpfLqFarciAcDiMSiVw/EMiQGmqaBm/hodFowHVnGCrdXl6SMBVos2WJjk31zjRfcbowvJUhGpBIJFAoFJDNZlEsFhGPx2FZlnzxqIyiWdTVN+euKTxcqVSQTqcFMJPJIJfLwTAMMYKlMvn8ef09qbvruh8aJpNJ9NXo8pPmlEolrFYrYca7fS95hpWyKnGZGjIc24J9mTI0abfbPXzlWCkrEIbUkMzq9Zq0UE/NR5+hr9+9pLa8XcKQG9SQrWIYFdGOvcc1deFcDEpq2FIzlXP0HQ84siGNrIiSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"2\" title=\"2\" src=\"/static/963cdf6186878503e2312a3c658d9b92/6b9fd/2.png\" srcset=\"/static/963cdf6186878503e2312a3c658d9b92/8a4e8/2.png 150w,\n/static/963cdf6186878503e2312a3c658d9b92/5a46d/2.png 300w,\n/static/963cdf6186878503e2312a3c658d9b92/6b9fd/2.png 518w\" sizes=\"(max-width: 518px) 100vw, 518px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n<p>이 과정에서 <code class=\"language-text\">foo</code>함수가 먼저 실행이 되고 <strong>콜스택</strong>이 비어있게되면<br/>\n<strong>이벤트 루프</strong>가 <code class=\"language-text\">bar</code>함수를 <strong>콜스택</strong>에 추가해주게 된다.<br/></p>\n<h2 id=\"settimeout\" style=\"position:relative;\"><a href=\"#settimeout\" aria-label=\"settimeout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>setTimeout</h2>\n<p><code class=\"language-text\">setTimeout</code>함수는 <strong>Web API</strong>에 포함되어있는 함수다.<br/>\n<strong>Web API</strong>는 브라우저에 내장되어 있으며 <code class=\"language-text\">AJAX</code>, <code class=\"language-text\">DOM</code>, <code class=\"language-text\">setTimeout</code> 등이 있다.<br/>\n<code class=\"language-text\">Javscript</code>자체에 존재하지는 않지만 <code class=\"language-text\">Javascript</code>기반으로 만들어졌다.<br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>이벤트 루프</strong>에서 설명했던 위의 예시의 설명을 보면 <code class=\"language-text\">setTimeout</code>에 등록된<br/>\n<code class=\"language-text\">bar</code>콜백함수를 바로 <strong>메시지 큐</strong>에 넣는 것 처럼 설명을 했지만 실제로는 그렇지 않다.<br/>\n2번째 인자로 받은 일정 시간이 지난 후에 <strong>메시지 큐</strong>에 등록이 된다.<br/>\n따라서 <code class=\"language-text\">setTimeout</code>함수에 <strong>2번째 인자로 준 시간 뒤에 실행된다는 보장은 없다</strong>.<br/>\n해당 시간이 지난 후 <strong>메시지 큐</strong>에 등록이되며 또한 <strong>콜스택</strong>이 비어있어야<br/>\n<strong>이벤트 루프</strong>를 통해 등록된 콜백 함수가 <strong>콜스택</strong>에 위치 될 수 있다.<br/></p>","frontmatter":{"title":"메시지 큐와 이벤트 루프","date":"June 24, 2020","thumbnail":null}}},"pageContext":{"slug":"/Javascript/2020-06-24-Messag_Queue_Event_Loop/","previous":{"fields":{"slug":"/Django/2020-06-08-Django-JWT-2/"},"frontmatter":{"title":"Pure Django로 JWT인증 구현하기 (2)","category":"Django","draft":false}},"next":{"fields":{"slug":"/Javascript/2020-06-29-setTimeout_setInterval_requestAnimationFrame/"},"frontmatter":{"title":"setTimeout, setInterval and requestAnimationFrame","category":"Javascript","draft":false}}}},"staticQueryHashes":["3001444076","3128451518"]}